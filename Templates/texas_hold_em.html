<!-- The following line of code ensures that this HTML template is...
a "child" of the "base" template we've created. -->
{% extends 'base.html' %}

<!-- In order to alter the pre-defined [block] of the "base" HTML template...
that is meant to be manipulated by its "children", we must first write... -->
{% block content %}
<!-- Then, we can fill this [block] w/ anything our heart desires. -->

  <h1>Texas Hold'em</h1>
  <p>You are playing heads-up against a computer opponent. Good luck!</p>

  <table id="active-user">
    <tr>
      <th>{{ players[0].name }}{% if players[0].dealer %} (dealer) {% endif %}</th>
    </tr>
    <tr id="user-chip-count">
      <th>Chip Count: </th>
        <td id="user-initial-stack">{{ players[0].stack }}</td>
    </tr>
    <tr>
      <th>Hand: </th>
        <td>{% for card in players[0].hole_cards %} {{ card.reveal() }} {% endfor %}</td>
    </tr>
    <tr id="user-commited">
      <th>Commited Chips: </th>
        <td id="user-blind">{{ players[0].pre_flop_bet }}</td>
    </tr>
    <tr id="user-score">
      <th>Score: </th>
    </tr>
    <tr id="user-options">
      <th>Action: </th>

        <!-- If the active-user is the dealer, then they begin the game...
        in the small blind, and thus have the option to call. Otherwise...
        their options depend on decisions made by their ai-opponent. -->

        <td><form method="POST"><button id="call-pre-flop-btn">Call</button></form></td>

        
        <!-- Initially (at least in a heads-up game), players always...
        have the option to raise. However, in each round of betting...
        there is a maximum of one initial bet followed by three raises. -->
        <td><form method="POST">{% include "_form.html" %} <button>Raise</button></form></td>

        <!-- In a game of Texas Hold'em, users always have the option...
        to fold, whether or not it makes sense to do so. -->
        <td><form action="/texas_hold_em/user_fold/{{ user.id }}"><button id="fold-btn">Fold</button></form></td>

        <!-- The following three buttons are vital bc they each trigger...
        key events in a given hand of Texas Hold'em. Their state is "hidden"...
        by default, and they will be revealed to users when appropriate. -->
        <td><button hidden id="reveal-flop-btn">Reveal Flop</button></td>
        <td><button hidden id="reveal-turn-btn">Reveal Turn</button></td>
        <td><button hidden id="reveal-river-btn">Reveal River</button></td>

        <!-- Only one of these "showdown" buttons will be generated...
        every time this HTML template is rendered. Even though they...
        activate markedly different paths when clicked (one is aligned...
        to a user-win, while the other is aligned to a user-loss), they...
        are indistinguishable from the user's point-of-view. -->
        <td hidden id="showdown">
          {% if players[0].hand_ranking > players[1].hand_ranking %}
          <form id="showdown-win-form" action="/texas_hold_em/win/{{ user.id }}">
            <button id="showdown-win-btn">Showdown</button>
          </form>
          {% elif players[1].hand_ranking > players[0].hand_ranking %}
          <form id="showdown-loss-form" action="/texas_hold_em/loss/{{ user.id }}">
            <button id="showdown-loss-btn">Showdown</button>
          </form>
          {% endif %}
        </td>
      </tr>
  </table>
  <br>
  <table id="board">
    <tr id="community-cards">
      <th>Community Cards: </th>
    </tr>
    <tr id="pot">
      <th>Pot: </th>
        <td id="sum-of-blinds">{{ players[0].pre_flop_bet + players[1].pre_flop_bet }}</td>
    </tr>
  </table>
  <br>
  <table id="ai-opp">
    <tr>
      <th>{{ players[1].name }}{% if players[1].dealer %} (dealer) {% endif %}</th>
    </tr>
    <tr id="ai-opp-chip-count">
      <th>Chip Count: </th>
        <td id="ai-opp-initial-stack">{{ players[1].stack }}</td>
    </tr>
    <tr id="ai-opp-hand">
      <th>Hand: </th>
    </tr>
    <tr id="ai-opp-commited">
      <th>Commited Chips: </th>
        <td id="ai-opp-blind">{{ players[1].pre_flop_bet }}</td>
    </tr>
    <tr id="ai-opp-score">
      <th>Score: </th>
    </tr>
  </table>

  <script src="https://unpkg.com/jquery"></script>
  <script src="https://unpkg.com/axios/dist/axios.js"></script>
  <script src="/static/texasHoldEm.js"></script>
{%endblock%}
